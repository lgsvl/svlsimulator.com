<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="LG Electronics America R&D Lab">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>NPC plugins - SVL Simulator</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "NPC plugins";
    var mkdocs_page_input_path = "plugins/npc-plugins.md";
    var mkdocs_page_url = "/docs/plugins/npc-plugins/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-130546445-1', 'svlsimulator.com');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <!-- edit link, open in new tab -->
        <a href="https://svlsimulator.com/docs/" class="icon icon-home" target="_blank_"> SVL Simulator</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Release Notes</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../release-notes/release-features/">Release features</a>
                </li>
                <li class="">
                    
    <a class="" href="../../release-notes/changelog/">Release notes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../release-notes/release-contents/">Contents of this release</a>
                </li>
                <li class="">
                    
    <a class="" href="../../release-notes/limitations-license-notice/">Limitations and license notice</a>
                </li>
                <li class="">
                    
    <a class="" href="../../archive/">Previous releases</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Installation Guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../installation-guide/system-requirements/">System requirements</a>
                </li>
                <li class="">
                    
    <a class="" href="../../installation-guide/installing-simulator/">Installation procedure</a>
                </li>
                <li class="">
                    
    <a class="" href="../../installation-guide/build-instructions/">Building from source</a>
                </li>
                <li class="">
                    
    <a class="" href="../../installation-guide/debugging-scripts/">Debugging Unity scripts</a>
                </li>
                <li class="">
                    
    <a class="" href="../../installation-guide/running-linux-gpu-applications-on-windows/">Running Linux GPU applications on Windows</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Getting Started</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../getting-started/introduction/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../getting-started/conventions/">Conventions</a>
                </li>
                <li class="">
                    
    <a class="" href="../../getting-started/getting-started/">Run a simulation</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tutorials</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../tutorials/modular-testing/">Modular testing with the Apollo AD stack</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tutorials/lane-following/">Deep learning lane following model</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tutorials/create-ros2-ad-stack/">Creating a simple ROS2-based AD stack</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tutorials/ground-truth-obstacles/">Viewing and subscribing to ground truth obstacles</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tutorials/robotics-pub-sub/">Running a basic Robotics Simulation with ROS 2</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tutorials/robotics-ros2/">Robot simulation with ROS 2 Navigation Stack</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tutorials/robotics-mapping/">Mapping a simulation environment in ROS 2</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tutorials/local-automation-tutorial/">Local Automation (CI/CD) Tutorial</a>
                </li>
                <li class="">
                    
    <a class="" href="../../tutorials/running-on-aws/">Running SVL Simulator on AWS</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">User Interface</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">Web User Interface</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user-interface/web/store/">Store</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user-interface/web/library/">Library</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user-interface/web/clusters/">Clusters</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user-interface/web/simulations/">Simulations</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user-interface/web/test-results/">Test Results</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Simulation User Interface</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../user-interface/simulator-main-menu/">Simulator main menu</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user-interface/simulation-menu/">Simulation menu</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user-interface/sensor-visualizers/">Sensor visualizers</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user-interface/bridge-connection-ui/">Bridge connection UI</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user-interface/config-and-cmd-line-params/">Configuration file and command line parameters</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../user-interface/keyboard-shortcuts/">Keyboard shortcuts</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">System Under Test</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../system-under-test/sut-introduction/">Introduction</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Messages</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../system-under-test/simulator-messages/">Simulator messages</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../system-under-test/lgsvl-msgs/">The lgsvl_msgs package</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../system-under-test/sensor-message-publishing/">Sensor message publishing</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../system-under-test/autoware-instructions/">ROS (Autoware.AI)</a>
                </li>
                <li class="">
                    
    <span class="caption-text">ROS 2</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../system-under-test/autoware-auto-instructions/">Autoware.Auto</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../system-under-test/ros2-bridge/">Setting up ROS 2 bridge</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Apollo</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../system-under-test/apollo-master-instructions/">Latest Apollo</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../system-under-test/apollo5-0-instructions/">Apollo 5.0</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Running Simulations</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../running-simulations/runtime-templates/">Runtime templates</a>
                </li>
                <li class="">
                    
    <a class="" href="../../running-simulations/running-simulator/">Running Simulator</a>
                </li>
                <li class="">
                    
    <a class="" href="../../running-simulations/offline-mode/">Offline mode</a>
                </li>
                <li class="">
                    
    <a class="" href="../../running-simulations/developer-mode/">Developer mode</a>
                </li>
                <li class="">
                    
    <a class="" href="../../running-simulations/local-automation/">Local Automation (CI/CD)</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Creating Scenarios</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">Visual scenario editor (VSE)</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../visual-scenario-editor/about-vse/">About VSE</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../visual-scenario-editor/using-vse/">Using VSE</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../visual-scenario-editor/vse-inspector/">VSE Inspector</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../visual-scenario-editor/vse-editors/">VSE Editors</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../visual-scenario-editor/vse-extensions/">VSE Extensions</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Python API</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../python-api/python-api/">Python API guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python-api/api-quickstart-descriptions/">Python API quickstart guide</a>
                </li>
                <li class="">
                    
    <a class="" href="../../python-api/dreamview-api/">Dreamview API</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Simulation Content</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../simulation-content/sharing/">Sharing assets</a>
                </li>
                <li class="">
                    
    <a class="" href="../../simulation-content/assets/">Building content</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Maps</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../simulation-content/add-new-map/">Creating a new map</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../simulation-content/map-annotation/">Map annotation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../simulation-content/hd-map-mesh-generation/">Road network generation</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../simulation-content/add-destinations/">Adding destinations to a map</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../simulation-content/pointcloud-import/">Point cloud import</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../simulation-content/pointcloud-rendering/">Point cloud rendering</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../simulation-content/pointcloud-export/">Point cloud export</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../simulation-content/lane-line-detector/">Lane-line detector</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../simulation-content/lighting-for-interiors/">Lighting for indoor environments</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Vehicles</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../simulation-content/add-new-ego-vehicle/">Creating a new ego vehicle</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../simulation-content/ego-vehicle-dynamics/">Vehicle dynamics</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">Sensors</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../simulation-content/sensors-list/">List of sensors</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../simulation-content/lane-line-sensor/">Lane-line sensor</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../simulation-content/differential-drive-control/">Differential Drive Control sensor</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">SDF</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../simulation-content/sdf-import/">Importing SDF world files</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Plugins</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../sensor-plugins/">Sensor plugins</a>
                </li>
                <li class="">
                    
    <a class="" href="../bridge-plugins/">Bridge plugins</a>
                </li>
                <li class="">
                    
    <a class="" href="../controllable-plugins/">Controllable plugins</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">NPC plugins</a>
    <ul class="subnav">
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../pedestrian-plugins/">Pedestrian plugins</a>
                </li>
                <li class="">
                    
    <a class="" href="../developer-debug-mode/">Developer Debug mode</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Digital Twin</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../digital-twin/gomentum-dtl/">Digital Twin Lite example map</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Distributed Simulation</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../distributed-simulation/distributed-simulation-introduction/">Introduction</a>
                </li>
                <li class="">
                    
    <a class="" href="../../distributed-simulation/running-distributed-simulation/">Running distributed simulation</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Third Party Integration</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../third-party-integration/openai-gym/">OpenAI Gym</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Support</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../support/troubleshooting/">Troubleshooting</a>
                </li>
                <li class="">
                    
    <a class="" href="../../support/unity-help/">Unity help</a>
                </li>
                <li class="">
                    
    <a class="" href="../../support/faq/">Frequently asked questions</a>
                </li>
                <li class="">
                    
    <a class="" href="../../support/contributing/">Contributing</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">SVL Simulator</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Plugins &raquo;</li>
        
      
    
    <li>NPC plugins</li>
    <li class="wy-breadcrumbs-aside">
      
      <!-- edited to not display Github edit link -->
        <a style="display:none;" href="https://github.com/lgsvl/simulator/edit/master/Docs/plugins/npc-plugins.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="npc-plugins">NPC Plugins <a href="#top"></a><a class="headerlink" href="#npc-plugins" title="Permanent link">#</a></h1>
<p>Non ego traffic vehicles (NPCs) are plugins that have the ability to be customized in appearance and behavior in your simulations. This allows you to add local variations of vehicle styles and brands or implement encounters with vehicles displaying distinguished behaviors, such as erratic driving or vehicles stopping frequently (e.g., delivery vehicles, trash pick up, bicycles).</p>
<p><strong>NOTE:</strong> Default NPCs are no longer included in simulator source and must be built locally from source for custom binaries.  See <a href="../../installation-guide/build-instructions/">build instructions</a>.</p>
<h2> Table of Contents</h2>
<div class="toc">
<ul>
<li><a href="#npc-models">NPC Models</a></li>
<li><a href="#npc-animations">NPC Animations</a></li>
<li><a href="#building-npc-plugins">Building NPC Plugins</a></li>
<li><a href="#npc-behaviors">NPC Behaviors</a></li>
<li><a href="#creating-npc-behavior-plugins">Creating NPC Behavior Plugins</a></li>
<li><a href="#creating-npc-model-plugins">Creating NPC Model Plugins</a><ul>
<li><a href="#npc-meta-data">NPC Meta Data</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="npc-models">NPC Models <a class="wikilink" href="#top">top</a><a class="headerlink" href="#npc-models" title="Permanent link">#</a></h2>
<p>NPC Models allow customization of NPC visuals, most notably the 3D model of vehicles, but also the material used for the car paint or windows.
With supporting custom NPC models we also added the support for motorbikes and vehicles with more two axles as well as more than one steering axle as is found on heavy vehicles.</p>
<p>NPC models must include a named <code>Collider</code> node that is a simplified mesh to attach a Unity mesh collider.  The mesh renderer is <strong>NOT</strong> active and the collider must be marked Convex.</p>
<p><a href="../../images/full_size_images/npc-collider.png"><img alt="" src="../../images/npc-collider.png" /></a></p>
<p>NPCs now support different RigidBody and WheelCollider settings.  Users can add these components exactly like EGO vehicle creation and they will override the NPC defaults.  This allows support for smaller or larger vehicles with very different physics settings.</p>
<ul>
<li>RigidBody component can be added to the root of the NPC model.</li>
<li>RigidBody reference must be set in the inspector if it is added to the model.</li>
<li>Wheel Collider Holder object can be added to the root of the model with child wheel collider objects, aligned at the origin.</li>
<li>Wheel Collider Holder object reference must be set in the inspector if it is added to the model.</li>
<li>Wheel Data must be set for each wheel if a Wheel Collider Holder object was set in the inspector.</li>
</ul>
<p><a href="../../images/full_size_images/npc-override-meta.png"><img alt="" src="../../images/npc-override-meta.png" /></a></p>
<p><a href="../../images/full_size_images/npc-override-wheel.png"><img alt="" src="../../images/npc-override-wheel.png" /></a></p>
<p>We classify NPCs into size categories which decide the spawning frequency as well as which paint colors are more common for which NPC size type.
The following table lists all currently implemented size types and the weight that correlates to their relative probability of encountering this type.</p>
<table>
<thead>
<tr>
<th align="center">NPC Size Type</th>
<th align="center">Spawn Weight</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">Compact</td>
<td align="center">5</td>
</tr>
<tr>
<td align="center">MidSize</td>
<td align="center">6</td>
</tr>
<tr>
<td align="center">Luxury</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">Sport</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">LightTruck</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">SUV</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">MiniVan</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">Large</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">Emergency</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">Bus</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">Trailer</td>
<td align="center">0</td>
</tr>
<tr>
<td align="center">Motorcycle</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">Bicycle</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">F1Tenth</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<p>In this example, trailer type has a weight of zero, indicating that it should not spawn by itself, while MidSize type has the highest weight, indicating that it is the most frequent vehicle on the road. The NPC Type is configured via a <a href="#npc-meta-data">Component added to the root of the prefab</a>.</p>
<p>Similarly, colors for each spawned vehicle is picked from a table for each vehicle type.</p>
<p>NPC asset bundles are detected from <code>&lt;simulator installation path&gt;/AssetBundles/NPCs</code> and added to the simulation automatically.</p>
<h2 id="npc-animations">NPC Animations <a class="wikilink" href="#top">top</a><a class="headerlink" href="#npc-animations" title="Permanent link">#</a></h2>
<p>NPC animations are supported in SVL Simulator. They must be included in the model data and require an AnimationController.controller asset.  This controller is the animation state machine that is referenced in the Animator component on the model root object.</p>
<p><a href="../../images/full_size_images/npc-animator.png"><img alt="" src="../../images/npc-animator.png" /></a></p>
<p>In the animation controller, the animation parameter named <code>speed</code> must be setup and set as a transition condition. With this parameter, npc animation speed and transitions can be effected by the npc rigidbody speed. This is the only default parameter supported in the npc controller.</p>
<p><a href="../../images/full_size_images/npc-animation-controller.png"><img alt="" src="../../images/npc-animation-controller.png" /></a></p>
<h2 id="building-npc-plugins">Building NPC Plugins <a class="wikilink" href="#top">top</a><a class="headerlink" href="#building-npc-plugins" title="Permanent link">#</a></h2>
<p>NPCs can be grouped into collections to allow you to import regional collections of vehicles. Place NPCs in <code>Assets/External/NPCs/CollectionFolder/</code> in separate named folders to have all <code>CollectionFolder</code> vehicles show up in the build menu in a group.</p>
<p>To build an external NPC,</p>
<ol>
<li>Open <code>Simulator -&gt; Build...</code> menu item</li>
<li>Select an NPC in the build window</li>
<li>Click <code>Build</code></li>
</ol>
<p><a href="../../images/full_size_images/build-npcs.png"><img alt="" src="../../images/build-npcs.png" /></a></p>
<p>The bundle named <code>npc_XXX</code> will be placed in the <code>AssetBundles/NPCs/CollectionFolder</code> folder in source code.  This is where simulator loads NPC bundles at runtime. To have NPCs load in a binary, they must be placed in the AssetBundles/NPCs/ folder in that binary.</p>
<p>See <a href="../../installation-guide/build-instructions/">build instructions</a> for more details.</p>
<h2 id="npc-behaviors">NPC Behaviors <a class="wikilink" href="#top">top</a><a class="headerlink" href="#npc-behaviors" title="Permanent link">#</a></h2>
<p>NPC Behaviors allow NPC Vehicles to behave in custom ways different from the provided built-in NPC behavior and are enabled and configured through the Python API.</p>
<p>Before running the simulator (running the executable or pressing <code>Play</code> in the Editor) NPC behavior plugins must be built by the simulator using <code>Simulator -&gt; Build...</code> menu and the built asset placed in the <code>AssetBundles/NPCs</code> folder in the source code or binary.</p>
<p>Open-source example:</p>
<ul>
<li><a href="https://github.com/lgsvl/ExampleNPCs/DrunkDriver">DrunkDriver</a></li>
</ul>
<h2 id="creating-npc-behavior-plugins">Creating NPC Behavior Plugins <a class="wikilink" href="#top">top</a><a class="headerlink" href="#creating-npc-behavior-plugins" title="Permanent link">#</a></h2>
<p>Create a folder in under your collection folder for each behavior, eg. <code>Assets/External/NPCs/BehavioursNPC/DrunkDriver/</code>.</p>
<p>If your plugin is a pure behavior, that is it has no visual components, we require one C# file to have the same name as the folder under the collection folder, for example note how the name <code>DrunkDriver</code> repeats in both the folder name and file name: <code>Assets/External/NPCs/BehavioursNPC/DrunkDriver/DrunkDriver.cs</code>.</p>
<p>The main class has to inherit from <code>NPCBehaviourBase</code> and implement its abstract methods to hook into the NPC simulation framework. It is also possible to inherit from <code>NPCLaneFollowingBehaviour</code> if you want to implement a slight modification of the default lane following behavior, such as this simple <code>DrunkDriver</code> example:</p>
<pre><code class="language-c#">using System.Collections;
using System.Collections.Generic;

using UnityEngine;
using Simulator.Api;
using Simulator.Map;
using Simulator.Utilities;
using SimpleJSON;

// In this example, we try to simulate a driver under ther influence of alcohol.
// We modify the default NPCLaneFollowingBehaviour because in principle this behavior
// shuld just add variation the the default behavior.
public class NPCDrunkDriverBehaviour : NPCLaneFollowBehaviour
{
    public float steerCorrectionMinTime = 0.0f;
    public float steerCorrectionMaxTime = 0.4f;

    public float steerDriftMin = 0.00f;
    public float steerDriftMax = 0.09f;

    protected float currentSteerDrift = 0.0f;
    protected float nextSteerCorrection = 0;
    // This function in the base class controls the NPC steering
    protected override void SetTargetTurn()
    {
        // we reduce the frequency at which steering is updated to the target heading to
        // simulate loss of attention or reduced reaction time
        if(nextSteerCorrection &lt; Time.fixedTime)
        {
            float steerCorrectionIn = RandomGenerator.NextFloat(steerCorrectionMinTime, steerCorrectionMaxTime);
            nextSteerCorrection = Time.fixedTime + steerCorrectionIn;

            // we add drift to the steering to simulate loss of fine motor skills
            currentSteerDrift = RandomGenerator.NextFloat(steerDriftMin, steerDriftMax);
            currentSteerDrift = currentSteerDrift * Mathf.Abs(RandomGenerator.NextFloat(-1.0f, 1.0f));
            // we can reuse the base steering at reduced frequency
            base.SetTargetTurn();
        }
        else
        {
            // steering drift correlating to driving speed
            currentTurn += currentSteerDrift * currentSpeed;
        }
    }
}
</code></pre>
<p>If you want to configure aspects of your NPC behavior from the Python API, you can add a class implementing the <code>ICommand</code> interface as shown in this example:</p>
<pre><code class="language-c#">class DrunkDriverControl : ICommand
{
    public string Name =&gt; &quot;agent/drunk/config&quot;;

    public void Execute(JSONNode args)
    {
        var uid = args[&quot;uid&quot;].Value;
        var api = ApiManager.Instance;

        if (!api.Agents.TryGetValue(uid, out GameObject npc))
        {
            api.SendError(this, $&quot;Agent '{uid}' not found&quot;);
            return;
        }

        var behaviour = npc.GetComponent&lt;NPCDrunkDriverBehaviour&gt;();
        if (behaviour == null)
        {
            api.SendError(this, $&quot;Agent '{uid}' is not a drunk driving NPC agent&quot;);
            return;
        }

        if(args.HasKey(&quot;correctionMinTime&quot;)) behaviour.steerCorrectionMinTime = args[&quot;correctionMinTime&quot;].AsFloat;
        if(args.HasKey(&quot;correctionMaxTime&quot;)) behaviour.steerCorrectionMaxTime = args[&quot;correctionMaxTime&quot;].AsFloat;
        if(args.HasKey(&quot;steerDriftMin&quot;)) behaviour.steerDriftMin = args[&quot;steerDriftMin&quot;].AsFloat;
        if(args.HasKey(&quot;steerDriftMax&quot;)) behaviour.steerDriftMax = args[&quot;steerDriftMax&quot;].AsFloat;

        api.SendResult(this);
    }
}
</code></pre>
<p>example usage from Python:</p>
<pre><code class="language-python"># common setup code omitted, check PythonAPI/quickstart for examples
# you can check if it has been loaded:
behaviours = sim.available_npc_behaviours
for i in range(len(behaviours)):
    if behaviours[i][&quot;name&quot;]==&quot;NPCDrunkDriverBehaviour&quot;: drunkDriverAvailable = True

#later...
npc = sim.add_agent(agent, lgsvl.AgentType.NPC, state)
if drunkDriverAvailable:
    inp = input(&quot;make drunk driver? yN&quot;)
if (inp == &quot;y&quot; or inp == &quot;Y&quot;):
    npc.set_behaviour(&quot;NPCDrunkDriverBehaviour&quot;)
    # usage of example command from C# plugin.
    npc.remote.command(&quot;agent/drunk/config&quot;, { &quot;uid&quot;: npc.uid, &quot;correctionMinTime&quot;:0.0, &quot;correctionMaxTime&quot;:0.6, &quot;steerDriftMin&quot;: 0.00, &quot;steerDriftMax&quot;:0.09})

# can still use lane following methods as those are inherited
npc.follow_closest_lane(True, 5.6)
</code></pre>
<h2 id="creating-npc-model-plugins">Creating NPC Model Plugins <a class="wikilink" href="#top">top</a><a class="headerlink" href="#creating-npc-model-plugins" title="Permanent link">#</a></h2>
<p>Create a folder under your collection folder for each Model, eg. <code>Assets/External/NPCs/YourCollection/YourNPC/</code>.
All assets of a NPC such as textures, additional materials or scripts are expected to live inside its folder.</p>
<p><a href="../../images/full_size_images/npc-components.png"><img alt="" src="../../images/npc-components.png" /></a></p>
<p>When an NPC is spawned, a NPCController script is attached to the root of the prefab instance, and it will try to find several components to animate the vehicle. To identify the components, we look at the Name property of the Components as follows:</p>
<table>
<thead>
<tr>
<th>GameObject Name</th>
<th>Component Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>LightHeadLeft</td>
<td>Light</td>
<td>Headlights which are controlled by the NPCController to off, regular, high beam etc states</td>
</tr>
<tr>
<td>LightHeadRight</td>
<td>Light</td>
<td>Headlights which are controlled by the NPCController to off, regular, high beam etc states</td>
</tr>
<tr>
<td>LightBrakeLeft</td>
<td>Light</td>
<td>Braking lights, controlled by the NPCController to reflect the vehicle braking</td>
</tr>
<tr>
<td>LightBrakeRight</td>
<td>Light</td>
<td>Braking lights, controlled by the NPCController to reflect the vehicle braking</td>
</tr>
<tr>
<td>IndicatorLeftFront</td>
<td>Light</td>
<td>Left indicator lights controlled by the NPCController when turning or when hazard lights are on</td>
</tr>
<tr>
<td>IndicatorLeftRear</td>
<td>Light</td>
<td>Left indicator lights controlled by the NPCController when turning or when hazard lights are on</td>
</tr>
<tr>
<td>IndicatorRightFront</td>
<td>Light</td>
<td>Right indicator lights controlled by the NPCController when turning or when hazard lights are on</td>
</tr>
<tr>
<td>IndicatorRightRear</td>
<td>Light</td>
<td>Right indicator lights controlled by the NPCController when turning or when hazard lights are on</td>
</tr>
<tr>
<td>IndicatorReverse</td>
<td>Light</td>
<td>Light turns on when NPC is reversing</td>
</tr>
<tr>
<td>Body</td>
<td>Renderer</td>
<td>Main vehicle body mesh</td>
</tr>
<tr>
<td>Body</td>
<td>Material</td>
<td>Material will have its _BaseColor changed to give each NPC a random color from a list</td>
</tr>
<tr>
<td>Collider</td>
<td>Renderer</td>
<td>Simplified collision mesh set to convex and less than 256 polygons</td>
</tr>
<tr>
<td>LightHead</td>
<td>Material</td>
<td>Material which is controlled to emit light in conjunction with headlight Lights</td>
</tr>
<tr>
<td>LightBrake</td>
<td>Material</td>
<td>Material which is controlled to emit light in conjunction with brake Lights</td>
</tr>
<tr>
<td>IndicatorLeft</td>
<td>Material</td>
<td>Material which is controlled to emit light in conjunction with left indicator Lights</td>
</tr>
<tr>
<td>IndicatorRight</td>
<td>Material</td>
<td>Material which is controlled to emit light in conjunction with right indicator Lights</td>
</tr>
<tr>
<td>IndicatorReverse</td>
<td>Material</td>
<td>Material which is controlled to emit light in conjunction with reversing Light</td>
</tr>
<tr>
<td>Wheel</td>
<td>Renderer</td>
<td>Renderer is used to create WheelCollider. NPCs with less than four wheels are assumed to be bikes</td>
</tr>
<tr>
<td>"Wheel" and "Front" or "Rear"</td>
<td>Renderer</td>
<td>Wheels that are supposed to turn when steering</td>
</tr>
</tbody>
</table>
<h3 id="npc-meta-data">NPC Meta Data <a class="wikilink" href="#top">top</a><a class="headerlink" href="#npc-meta-data" title="Permanent link">#</a></h3>
<p>Additional information about the NPC prefab is added by attaching a Unity <code>MonoBehaviour</code> Component called <code>NPCMetaData</code> added to each prefab.</p>
<p><a href="../../images/full_size_images/npc-metadata.png"><img alt="" src="../../images/npc-metadata.png" /></a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../pedestrian-plugins/" class="btn btn-neutral float-right" title="Pedestrian plugins">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../controllable-plugins/" class="btn btn-neutral" title="Controllable plugins"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2019-2022 LG Electronics Inc.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/lgsvl/simulator/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../controllable-plugins/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../pedestrian-plugins/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../javascripts/clipboard.js" defer></script>
      <script src="../../javascripts/copy-to-clipboard.js" defer></script>
      <script src="../../javascripts/config.js" defer></script>
      <script src="https://polyfill.io/v3/polyfill.min.js?features=es6" defer></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
